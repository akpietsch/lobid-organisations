@(id: String, content: com.fasterxml.jackson.databind.JsonNode)

@import play.api.libs.json._
@import play.api.libs.functional.syntax._

@main(id) {
    <h1>@id</h1>
    
    @defining(Json.parse(content.toString())) { parsedContent =>
        <table>
            @produceRow("Name", parsedContent \ "name", false)            
            @produceRow("ISIL", parsedContent \ "isil", false)          
            @produceRow("DBS ID", parsedContent \ "dbsID", false)
            @produceRow("Wikipedia", parsedContent \ "wikipedia", true)
            @produceRow("URL", parsedContent \ "url", true)            
            @produceRow("Telefon", parsedContent \ "telephone", false)
            @produceRow("Email", parsedContent \ "email", true)
            @produceRow("Typ", parsedContent \ "type", false)
            @produceRow("Bibliothekstyp", parsedContent \ "classification" \ "label", false)
            @produceRow("Träger", parsedContent \ "fundertype" \ "label", false)
            @produceRow("Bestandsgröße", parsedContent \ "stocksize" \ "label", false)
            
            @for(alternateName <- (parsedContent \ "alternateName").asOpt[Seq[JsValue]].getOrElse(Seq())) {
                 @produceRow("Anderer Name", alternateName, false)
            }
            
        </table>
        
        @if((parsedContent \ "address").asOpt[JsObject].isDefined) {
         <h3>Postanschrift</h3>
         <table>
            @produceRow("Postfach", parsedContent \ "address" \ "postOfficeBoxNumber", false)
            @produceRow("Postleitzahl", parsedContent \ "address" \ "postalCode", false)
            @produceRow("Stadt", parsedContent \ "address" \ "addressLocality", false)    
         </table>
        }
        @defining((parsedContent \ "location").asOpt[Seq[JsValue]].getOrElse(Seq())) { locations =>
         <h3>Standort@if(locations.size>1){e}</h3>
         @for(location <- locations) {
            @produceTable(location)
         }
        }
    }
    <p>You can also access <a href='@routes.Application.get(id=id, format="json")'>this data</a> using our <a href="@routes.Application.api()">API</a>.</p>
}

@produceRow(name: String, value: JsValue, link: Boolean) = {
    @if(!value.isInstanceOf[JsUndefined]){
        @defining(value.as[String].substring(0,value.as[String].length())) { valueAsString =>
            <tr>
                <td class="field-label">
                    @name
                </td>
                <td class="field-value">
                    @if(!link) {
                        @valueAsString
                    } else {
                        <a href="@valueAsString">@valueAsString</a>
                    }
                </td>
            </tr>
        }
    }
}

@produceTable(location: JsValue) = {
    <p>
        <table>
            @produceRow("Straße, Hausnr.", (location \ "address" \ "streetAddress"), false)
            @produceRow("Postleitzahl", (location \ "address" \ "postalCode"), false)
            @produceRow("Stadt", (location \ "address" \ "addressLocality"), false)
            @produceRow("Land", (location \ "address" \ "addressCountry"), false)
            @produceRow("Öffnungzeiten", (location \ "openingHoursSpecification" \ "description"), false)
        </table>
    </p>
}
