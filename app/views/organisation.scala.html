@(id: String, content: com.fasterxml.jackson.databind.JsonNode, hasGeoData: Boolean)

@import play.api.libs.json._

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>

@main("", if(hasGeoData){makeMap()}else{Html("")}) {
    <h1>@id</h1>
    @defining(Json.parse(content.toString())) { parsedContent =>
    <p>
      <div class="row">
        <div class="col-md-@if(hasGeoData){6}else{12}">
          <p>
          <table class='table table-striped table-condensed'>
              @produceRow("Name", parsedContent \ "name", false)
              @produceRow("ISIL", parsedContent \ "isil", false)
              @produceRow("DBS ID", parsedContent \ "dbsID", false)
              @produceRow("Wikipedia", parsedContent \ "wikipedia", true)
              @produceRow("URL", parsedContent \ "url", true)
              @produceRow("Telefon", parsedContent \ "telephone", false)
              @produceRow("Email", parsedContent \ "email", true)
              @produceRow("Typ", parsedContent \ "type", false)
              @produceRow("Bibliothekstyp", parsedContent \ "classification" \ "label", false)
              @produceRow("Träger", parsedContent \ "fundertype" \ "label", false)
              @produceRow("Bestandsgröße", parsedContent \ "stocksize" \ "label", false)

              @for(alternateName <- (parsedContent \ "alternateName").asOpt[Seq[JsValue]].getOrElse(Seq())) {
                   @produceRow("Anderer Name", alternateName, false)
              }
          </table>
          </p>
        </div>
        @if(hasGeoData){
          <div class="col-md-6">
              <ul class="nav nav-tabs">
                @if((parsedContent \ "location").asOpt[Seq[JsValue]].getOrElse(Seq()).length > 1
                  || ((parsedContent \ "location").asOpt[Seq[JsValue]].getOrElse(Seq()).length == 1
                     && (parsedContent \ "address").asOpt[JsObject].isDefined)) {
                  @for(i <- 0 to (parsedContent \ "location").asOpt[Seq[JsValue]].getOrElse(Seq()).length-1) {
                    @if(i == 0) {
                      <li class="active"><a href="#organisations-map@i">Standort @(i+1)</a></li>
                    } else {
                      <li><a href="#organisations-map@i">Standort @(i+1)</a></li>
                    }
                  }
                }
                @if((parsedContent \ "address").asOpt[JsObject].isDefined) {
                  <li><a href="#postal-address">Postadresse</a></li>
                }
              </ul>
              <div class="tab-content">
                @if((parsedContent \ "location").asOpt[Seq[JsValue]].getOrElse(Seq()).length > 1
                  || ((parsedContent \ "location").asOpt[Seq[JsValue]].getOrElse(Seq()).length == 1
                     && (parsedContent \ "address").asOpt[JsObject].isDefined)) {
                  @for(i <- 0 to (parsedContent \ "location").asOpt[Seq[JsValue]].getOrElse(Seq()).length-1) {
                    @if(i == 0) {
                      <div id="organisations-map@i" class="tab-pane fade in active organisations-map"></div>
                    } else {
                      <div id="organisations-map@i" class="tab-pane fade organisations-map"></div>
                    }
                  }
                  @if((parsedContent \ "address").asOpt[JsObject].isDefined) {
                     <div id="postal-address" class="tab-pane fade">
                       <h3>Postadresse</h3>
                       <p>
                         <table class='table table-striped table-condensed'>
                           @produceRow("Postfach", parsedContent \ "address" \ "postOfficeBoxNumber", false)
                           @produceRow("Postleitzahl", parsedContent \ "address" \ "postalCode", false)
                           @produceRow("Stadt", parsedContent \ "address" \ "addressLocality", false)
                         </table>
                       </p>
                     </div>
                  }
                } else {
                  <div id="organisations-map0" class="organisations-map"></div>
                }
                @if((parsedContent \ "address").asOpt[JsObject].isDefined) {
                  <div id="postal-address" class="tab-pane fade">Display postal address</div>
                }
              </div>
          </div>
        }
      </div>
    </p>
    }

    <script>
      $(document).ready(function(){
        $(".nav-tabs a").click(function(){
          $(this).tab('show');
        });
      });
    </script>

    <p>You can also access <a href='@routes.Application.get(id=id, format="json")'>this data</a> using our <a href="@routes.Application.api()">API</a>.</p>
    
}

@produceRow(name: String, value: JsValue, link: Boolean) = {
    @if(value.asOpt[JsValue].isDefined){
        @defining(value.as[String].substring(0,value.as[String].length())) { valueAsString =>
            <tr>
                <td class="field-label">
                    @name
                </td>
                <td class="field-value">
                    @if(!link) {
                        @valueAsString
                    } else {
                        <a href="@valueAsString">@valueAsString</a>
                    }
                </td>
            </tr>
        }
    }
}

@makeMap() = {
<link rel="stylesheet" href='@controllers.routes.Assets.at("stylesheets/leaflet.css")' />
<script src='@controllers.routes.Assets.at("javascripts/leaflet.js")'></script>
<script src='@controllers.routes.Assets.at("javascripts/Leaflet.MakiMarkers.js")'></script>
<script async type='text/javascript' src='@routes.Application.get(id, "js")'></script>
}
