@(id: String, content: com.fasterxml.jackson.databind.JsonNode, hasGeoData: Boolean)

@import play.api.libs.json._

@main("", scripts = if(hasGeoData){makeMap()}else{Html("")}) {
    <h1>@id</h1>
    @defining(Json.parse(content.toString())) { parsedContent =>
    <p>
      <div class="row">
        <div class="col-md-@if(hasGeoData){6}else{12}">
          <p>
          <table class='table table-striped table-condensed'>
              @produceRow("Name", parsedContent \ "name", false)
              @produceRow("ISIL", parsedContent \ "isil", false)
              @produceRow("DBS ID", parsedContent \ "dbsID", false)
              @produceRow("Wikipedia", parsedContent \ "wikipedia", true)
              @produceRow("URL", parsedContent \ "url", true)
              @produceRow("Telefon", parsedContent \ "telephone", false)
              @produceRow("Email", parsedContent \ "email", true)
              @produceRow("Typ", parsedContent \ "type", false)
              @produceRow("Bibliothekstyp", parsedContent \ "classification" \ "label", false)
              @produceRow("Träger", parsedContent \ "fundertype" \ "label", false)
              @produceRow("Bestandsgröße", parsedContent \ "stocksize" \ "label", false)

              @for(alternateName <- (parsedContent \ "alternateName").asOpt[Seq[JsValue]].getOrElse(Seq())) {
                   @produceRow("Anderer Name", alternateName, false)
              }
          </table>
          </p>
          @if((parsedContent \ "address").asOpt[JsObject].isDefined) {
           <h3>Postanschrift</h3>
           <p>
           <table class='table table-striped table-condensed'>
              @produceRow("Postfach", parsedContent \ "address" \ "postOfficeBoxNumber", false)
              @produceRow("Postleitzahl", parsedContent \ "address" \ "postalCode", false)
              @produceRow("Stadt", parsedContent \ "address" \ "addressLocality", false)
           </table>
           </p>
          }
        </div>
        @if(hasGeoData){
        <div class="col-md-6">
            <div id="organisations-map"></div>
        </div>
        }
      </div>
    </p>
    }
    
    <p>You can also access <a href='@routes.Application.get(id=id, format="json")'>this data</a> using our <a href="@routes.Application.api()">API</a>.</p>
    
}

@produceRow(name: String, value: JsValue, link: Boolean) = {
    @if(value.asOpt[JsValue].isDefined){
        @defining(value.as[String].substring(0,value.as[String].length())) { valueAsString =>
            <tr>
                <td class="field-label">
                    @name
                </td>
                <td class="field-value">
                    @if(!link) {
                        @valueAsString
                    } else {
                        <a href="@valueAsString">@valueAsString</a>
                    }
                </td>
            </tr>
        }
    }
}

@makeMap() = {
<link rel="stylesheet" href='@controllers.routes.Assets.at("stylesheets/leaflet.css")' />
<script src='@controllers.routes.Assets.at("javascripts/leaflet.js")'></script>
<script src='@controllers.routes.Assets.at("javascripts/Leaflet.MakiMarkers.js")'></script>
<script async type='text/javascript' src='@routes.Application.get(id, "js")'></script>
}
